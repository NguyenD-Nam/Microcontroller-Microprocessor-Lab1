/*
 * ledmatrix_display.c
 *
 *  Created on: Sep 23, 2021
 *      Author: DELL
 */

#include "main.h"
#include "ledmatrix_display.h"


#define NUMBER_OF_LEDS	12
#define Clk_delay	1000

static uint8_t ledmatrixVals[NUMBER_OF_LEDS]={0};
static uint8_t seconds=0;
static uint8_t minutes=0;
static uint8_t hours=0;

void update_led_matrix_buffer(void){
	HAL_GPIO_WritePin(ALL_PORTS, LED_1_Pin, ledmatrixVals[0]);
	HAL_GPIO_WritePin(ALL_PORTS, LED_2_Pin, ledmatrixVals[1]);
	HAL_GPIO_WritePin(ALL_PORTS, LED_3_Pin, ledmatrixVals[2]);
	HAL_GPIO_WritePin(ALL_PORTS, LED_4_Pin, ledmatrixVals[3]);
	HAL_GPIO_WritePin(ALL_PORTS, LED_5_Pin, ledmatrixVals[4]);
	HAL_GPIO_WritePin(ALL_PORTS, LED_6_Pin, ledmatrixVals[5]);
	HAL_GPIO_WritePin(ALL_PORTS, LED_7_Pin, ledmatrixVals[6]);
	HAL_GPIO_WritePin(ALL_PORTS, LED_8_Pin, ledmatrixVals[7]);
	HAL_GPIO_WritePin(ALL_PORTS, LED_9_Pin, ledmatrixVals[8]);
	HAL_GPIO_WritePin(ALL_PORTS, LED_10_Pin, ledmatrixVals[9]);
	HAL_GPIO_WritePin(ALL_PORTS, LED_11_Pin, ledmatrixVals[10]);
	HAL_GPIO_WritePin(ALL_PORTS, LED_12_Pin, ledmatrixVals[11]);
}

// Exercise 6
void setAllClock(void){
	for(int i = 0; i < NUMBER_OF_LEDS; i++){
		ledmatrixVals[i]=1;
	}
	update_led_matrix_buffer();
}

// Exercise 7
void clearAllClock(void){
	for(int i = 0; i < NUMBER_OF_LEDS; i++){
		ledmatrixVals[i]=0;
	}
	update_led_matrix_buffer();
}

// Exercise 8
void setNumberOnClock(int num){
//	clearAllClock();
	ledmatrixVals[num]=1;
	update_led_matrix_buffer();
}
void checksetNOC(void){
	for(int i = 0; i < NUMBER_OF_LEDS; i++){
		setNumberOnClock(i);
		HAL_Delay(1000);
	}
}

// Exercise 9
void clearNumberOnClock(int num){
//	setAllClock();
	ledmatrixVals[num]=0;
	update_led_matrix_buffer();
}
void checkclearNOC(void){
	for(int i = 0; i < NUMBER_OF_LEDS; i++){
		clearNumberOnClock(i);
		HAL_Delay(1000);
	}
}

// Exercise 10
void runClock(void){
	static uint8_t s_idx=0;
	static uint8_t m_idx=0;
	static uint8_t h_idx=0;

	setNumberOnClock(0);
	HAL_Delay(Clk_delay);

	while(1){
//		clearAllClock();
		setNumberOnClock(s_idx);
		setNumberOnClock(m_idx);
		setNumberOnClock(h_idx);

		seconds += 5;
//		if(seconds >= 59) {
//			minutes += 5;
//		}
//		if(minutes >= 59) {
//			hours += 5;
//		}

		if(seconds % 5 == 0) {
			clearNumberOnClock(s_idx);
			s_idx++;
			if(s_idx > 11) s_idx = 0;
			setNumberOnClock(s_idx);
		}
//		if(minutes > 0 && minutes % 5 == 0) {
//			clearNumberOnClock(m_idx);
//			m_idx++;
//			if(m_idx > 11) m_idx = 0;
//			setNumberOnClock(m_idx);
//		}
//		if(hours > 0 && hours % 5 == 0) {
//			clearNumberOnClock(h_idx);
//			h_idx++;
//			if(h_idx > 11) h_idx = 0;
//			setNumberOnClock(h_idx);
//		}
		HAL_Delay(Clk_delay);
	}
}
